@startuml SafeHeight_Monitor_User_Flow
skinparam backgroundColor #FEFEFE
skinparam activity {
  BackgroundColor<<Screen>> #E3F2FD
  BorderColor<<Screen>> #1976D2
  BackgroundColor<<Decision>> #FFF9C4
  BorderColor<<Decision>> #F57C00
  BackgroundColor<<Action>> #E8F5E9
  BorderColor<<Action>> #388E3C
  BackgroundColor<<Alert>> #FFEBEE
  BorderColor<<Alert>> #C62828
}

title SafeHeight Monitor - User Flow Diagram

start

:Відкрити додаток SafeHeight Monitor;

:WF-01: Екран автентифікації<<Screen>>;

note right
  **Вхідна точка системи**
  - Вибір ролі користувача
  - Вибір методу автентифікації:
    • QR-код
    • PIN-код
    • Логін/Пароль
end note

if (Роль користувача?) then (Працівник)

  if (Метод автентифікації?) then (QR-код)
    :Сканувати QR-код на IoT пристрої<<Action>>;
  else (PIN-код)
    :Ввести 6-значний PIN-код<<Action>>;
  endif

  :Верифікація даних працівника<<Action>>;

  if (Автентифікація успішна?) then (Так)
    :Активувати IoT моніторинг<<Action>>;
    :Реєстрація на зміну<<Action>>;

    fork
      :IoT пристрій в режимі моніторингу;

      while (Під час робочої зміни?) is (Так)
        :Збір даних з сенсорів<<Action>>;
        :AI аналіз ризиків<<Action>>;

        if (Виявлено ризик?) then (Так - Критичний)
          :WF-03: Екран попередження<<Alert>>;

          note right
            **Критичне попередження**
            - Деталі загрози
            - Рекомендації
            - Дві кнопки дій
          end note

          if (Реакція працівника?) then (Я в безпеці)
            :Підтвердити отримання<<Action>>;
            :Логування події<<Action>>;
          else (Потрібна допомога!)
            :Активувати аварійний протокол<<Alert>>;
            :Сповіщення всіх відповідальних<<Alert>>;
            :Логування екстреної ситуації<<Action>>;

            fork
              :Інженер з ОП отримує алерт;
            fork again
              :Бригадир отримує алерт;
            fork again
              :Диспетчерська отримує алерт;
            end fork
          endif

        elseif (Виявлено ризик?) then (Увага)
          :Показати попередження (Увага)<<Action>>;
          :Вібрація/звукове попередження<<Action>>;
        else (Безпечно)
          :Нормальний режим роботи;
        endif
      endwhile (Зміна завершена)

      :Вихід з системи<<Action>>;

    fork again
      :Дані передаються на сервер;
    end fork

    stop

  else (Ні)
    :Показати помилку автентифікації<<Alert>>;
    end
  endif

elseif (Роль користувача?) then (Інженер з охорони праці)

  :Ввести логін і пароль<<Action>>;
  :Верифікація облікових даних<<Action>>;

  if (Автентифікація успішна?) then (Так)
    :WF-02: Панель моніторингу<<Screen>>;

    note right
      **Головна робоча панель**
      - Таблиця всіх працівників
      - Інтерактивна карта
      - Фільтри та пошук
      - Автооновлення кожні 5 сек
    end note

    while (Робоча сесія активна?) is (Так)

      fork
        :Автооновлення даних (5 сек)<<Action>>;
      fork again
        if (Дія користувача?) then (Пошук працівника)
          :Ввести ім'я/ID працівника<<Action>>;
          :Фільтрувати таблицю<<Action>>;
          :Показати результати пошуку;

        elseif (Дія користувача?) then (Фільтр за статусом)
          :Вибрати статус (Всі/Критично/Увага/Безпечно)<<Action>>;
          :Оновити таблицю<<Action>>;

        elseif (Дія користувача?) then (Фільтр за зоною)
          :Вибрати зону з випадаючого списку<<Action>>;
          :Оновити карту та таблицю<<Action>>;

        elseif (Дія користувача?) then (Деталі працівника)
          :Клік на [Деталі]<<Action>>;
          :Показати детальну інформацію працівника;
          note right
            - Повна історія статусів
            - Графік переміщень
            - Історія попереджень
            - Медичні дані
          end note

        elseif (Дія користувача?) then (Зв'язок з працівником)
          :Клік на [Зв'язок]<<Action>>;
          :Відкрити канал зв'язку (голос/текст)<<Action>>;
          :Спілкування з працівником;

        elseif (Дія користувача?) then (Повноекранна карта)
          :Клік на [Повноекранний режим]<<Action>>;
          :Відобразити карту на весь екран;
          :Детальніша візуалізація зон та працівників;

        elseif (Дія користувача?) then (Експорт даних)
          :Клік на [Експорт]<<Action>>;
          :Вибрати формат (CSV/Excel/PDF)<<Action>>;
          :Завантажити файл<<Action>>;

        elseif (Дія користувача?) then (Перейти до звітів)
          :Клік на вкладку "Звіти";
          :WF-05: Дашборд аналітики<<Screen>>;
          detach

        elseif (Дія користувача?) then (Налаштування)
          :Клік на вкладку "Налаштування";
          :Відкрити панель налаштувань;
          note right
            - Правила безпеки
            - Пороги попереджень
            - Налаштування сповіщень
            - Конфігурація зон
          end note

        elseif (Дія користувача?) then (IoT пристрої)
          :Клік на вкладку "IoT пристрої";
          :Відкрити панель керування пристроями;
          note right
            - Список всіх пристроїв
            - Статус (Online/Offline/Low Battery)
            - Призначення працівникам
            - Діагностика
          end note
        endif
      end fork

      if (Отримано критичний алерт?) then (Так)
        :Показати сповіщення про критичну ситуацію<<Alert>>;
        :Звуковий сигнал<<Alert>>;
        :Виділити працівника в таблиці (червоним)<<Alert>>;
        :Оцінити ситуацію<<Action>>;

        if (Потрібне втручання?) then (Так)
          :Зв'язатися з працівником<<Action>>;
          :Координувати дії з бригадиром<<Action>>;
        else (Працівник підтвердив безпеку)
          :Зняти алерт<<Action>>;
          :Логувати подію<<Action>>;
        endif
      endif

    endwhile (Вихід з системи)

    stop

  else (Ні)
    :Показати помилку автентифікації<<Alert>>;
    end
  endif

elseif (Роль користувача?) then (Бригадир)

  :Ввести логін і пароль<<Action>>;
  :Верифікація облікових даних<<Action>>;

  if (Автентифікація успішна?) then (Так)
    :WF-04: Екран керування зонами<<Screen>>;

    note right
      **Панель керування**
      - Інтерактивна карта зон
      - Таблиця зон
      - Моя бригада
    end note

    while (Робоча сесія активна?) is (Так)

      if (Дія користувача?) then (Створити нову зону)
        :Клік на [Створити нову зону]<<Action>>;
        :Відкрити діалог створення зони;
        :Ввести параметри зони:
        - Назва
        - Тип робіт
        - Поверхи
        - Площа
        - Макс. працівників<<Action>>;
        :Намалювати зону на карті<<Action>>;
        :Зберегти зону<<Action>>;
        :Оновити карту та таблицю<<Action>>;

      elseif (Дія користувача?) then (Редагувати зону)
        :Вибрати зону з таблиці/карти<<Action>>;
        :Клік на [Редагувати]<<Action>>;
        :Змінити параметри зони<<Action>>;
        :Перемалювати межі зони (опційно)<<Action>>;
        :Зберегти зміни<<Action>>;

      elseif (Дія користувача?) then (Видалити зону)
        :Вибрати зону<<Action>>;
        :Клік на [Видалити]<<Action>>;
        :Підтвердити видалення<<Action>>;

        if (Підтвердження?) then (Так)
          :Видалити зону<<Action>>;
          :Переназначити працівників з цієї зони<<Action>>;
          :Оновити карту та таблицю<<Action>>;
        else (Ні)
          :Скасувати операцію;
        endif

      elseif (Дія користувача?) then (Переназначити працівника)
        :Вибрати працівника з "Моя бригада"<<Action>>;
        :Клік на [Переназначити]<<Action>>;
        :Вибрати нову зону з випадаючого списку<<Action>>;

        if (Зона має вільні місця?) then (Так)
          :Переназначити працівника<<Action>>;
          :Оновити карту<<Action>>;
          :Відправити сповіщення працівнику<<Action>>;
        else (Ні - зона повна)
          :Показати попередження<<Alert>>;
          note right
            "Зона досягла максимальної
            кількості працівників"
          end note
        endif

      elseif (Дія користувача?) then (Зв'язок з працівником)
        :Вибрати працівника<<Action>>;
        :Клік на [Зв'язок]<<Action>>;
        :Відкрити канал комунікації<<Action>>;

      elseif (Дія користувача?) then (Додати працівника)
        :Клік на [Додати працівника]<<Action>>;
        :Вибрати працівника з загального списку<<Action>>;
        :Призначити зону<<Action>>;
        :Додати до бригади<<Action>>;

      elseif (Дія користувача?) then (Експорт розкладу)
        :Клік на [Експорт розкладу]<<Action>>;
        :Вибрати формат<<Action>>;
        :Завантажити файл<<Action>>;

      elseif (Дія користувача?) then (Перейти до панелі моніторингу)
        :Клік на вкладку "Панель";
        :WF-02: Панель моніторингу<<Screen>>;
        note right
          Бригадир також має доступ
          до панелі моніторингу,
          але бачить лише свою бригаду
        end note
        detach
      endif

      if (Отримано алерт про працівника?) then (Так)
        :Показати сповіщення<<Alert>>;
        :Виділити працівника в таблиці<<Alert>>;
        :Оцінити ситуацію<<Action>>;

        fork
          :Зв'язатися з працівником<<Action>>;
        fork again
          :Координувати з інженером з ОП<<Action>>;
        end fork
      endif

    endwhile (Вихід)

    stop

  else (Ні)
    :Показати помилку автентифікації<<Alert>>;
    end
  endif

elseif (Роль користувача?) then (Менеджер проекту)

  :Ввести логін і пароль<<Action>>;
  :Верифікація облікових даних<<Action>>;

  if (Автентифікація успішна?) then (Так)
    :WF-05: Дашборд аналітики та звітності<<Screen>>;

    note right
      **Аналітична панель**
      - Ключові метрики
      - Графіки трендів
      - Топ зон з ризиками
      - Рекомендації
    end note

    while (Робоча сесія активна?) is (Так)

      if (Дія користувача?) then (Налаштувати період звітності)
        :Вибрати період з випадаючого списку<<Action>>;
        note right
          Варіанти:
          - Сьогодні
          - Вчора
          - Останній тиждень
          - Останній місяць
          - Кастомний діапазон
        end note

        if (Період?) then (Кастомний)
          :Вибрати початкову дату<<Action>>;
          :Вибрати кінцеву дату<<Action>>;
        endif

        :Клік на [Генерувати звіт]<<Action>>;
        :Запит даних з бази даних<<Action>>;
        :AI аналіз даних<<Action>>;
        :Генерація метрик, графіків, рекомендацій<<Action>>;
        :Відобразити звіт<<Action>>;

      elseif (Дія користувача?) then (Експорт PDF)
        :Клік на [Експорт PDF]<<Action>>;
        :Генерувати PDF документ<<Action>>;
        :Включити всі графіки та таблиці<<Action>>;
        :Додати логотип та метадані<<Action>>;
        :Завантажити файл<<Action>>;

      elseif (Дія користувача?) then (Експорт Excel)
        :Клік на [Експорт Excel]<<Action>>;
        :Генерувати Excel файл<<Action>>;
        :Експортувати сирі дані<<Action>>;
        :Додати графіки як зображення<<Action>>;
        :Завантажити файл<<Action>>;

      elseif (Дія користувача?) then (Відправити email)
        :Клік на [Відправити email]<<Action>>;
        :Відкрити діалог відправки<<Action>>;
        :Ввести email адреси отримувачів<<Action>>;
        :Вибрати формат вкладення (PDF/Excel)<<Action>>;
        :Додати коментар (опційно)<<Action>>;
        :Відправити email<<Action>>;

      elseif (Дія користувача?) then (Друк звіту)
        :Клік на [Друк]<<Action>>;
        :Відкрити діалог друку<<Action>>;
        :Налаштувати параметри друку<<Action>>;
        :Надіслати на принтер<<Action>>;

      elseif (Дія користувача?) then (Переключити період графіка)
        :Клік на [День/Тиждень/Місяць]<<Action>>;
        :Агрегувати дані за новим періодом<<Action>>;
        :Перемалювати графік<<Action>>;

      elseif (Дія користувача?) then (Деталі зони з ризиком)
        :Клік на [Деталі] в таблиці топ-зон<<Action>>;
        :Показати детальну аналітику зони;
        note right
          - Історія інцидентів
          - Працівники в зоні
          - Типи робіт
          - Графік ризиків за часом
        end note

      elseif (Дія користувача?) then (Рекомендації для зони)
        :Клік на [Рекомендації]<<Action>>;
        :Показати AI-згенеровані рекомендації;
        note right
          - Конкретні заходи
          - Пріоритет виконання
          - Очікуваний ефект
        end note

      elseif (Дія користувача?) then (Зберегти як шаблон)
        :Клік на [Зберегти як шаблон]<<Action>>;
        :Зберегти налаштування звіту<<Action>>;
        :Додати до списку шаблонів<<Action>>;

      elseif (Дія користувача?) then (Поділитися звітом)
        :Клік на [Поділитися]<<Action>>;
        :Генерувати унікальне посилання<<Action>>;
        :Налаштувати права доступу<<Action>>;
        :Копіювати посилання в буфер обміну<<Action>>;

      elseif (Дія користувача?) then (Перейти до панелі моніторингу)
        :Клік на вкладку "Панель";
        :WF-02: Панель моніторингу<<Screen>>;
        detach

      elseif (Дія користувача?) then (Перейти до документів)
        :Клік на вкладку "Документи";
        :Відкрити бібліотеку документів;
        note right
          - Всі збережені звіти
          - Шаблони
          - Експортовані файли
          - Історія звітів
        end note
      endif

    endwhile (Вихід)

    stop

  else (Ні)
    :Показати помилку автентифікації<<Alert>>;
    end
  endif

else (Системний адміністратор)
  :Ввести логін і пароль<<Action>>;
  :Верифікація облікових даних<<Action>>;

  if (Автентифікація успішна?) then (Так)
    :Адміністративна панель;

    note right
      **Адмін панель**
      - Керування користувачами
      - Налаштування системи
      - Моніторинг серверів
      - Логи системи
      - Резервне копіювання
    end note

    stop

  else (Ні)
    :Показати помилку автентифікації<<Alert>>;
    end
  endif
endif

@enduml
