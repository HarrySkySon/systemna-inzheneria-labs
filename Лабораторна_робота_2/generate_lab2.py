#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Генератор лабораторної роботи №2
Тема: Виявлення вимог до нового програмного продукту (Use Cases)
Проект: SafeHeight Monitor - Моніторинг будівельних майданчиків
"""

import os
from datetime import datetime

# Базовий шлях до проекту
BASE_PATH = os.path.dirname(os.path.abspath(__file__))
LAB2_PATH = os.path.join(BASE_PATH, "Лабораторна_робота_2", "1-Requirements")

def create_use_cases():
    """Створює текстові описи варіантів використання"""

    use_cases = {
        "UC-01": {
            "name": "Реєстрація в системі на початку зміни",
            "actor": "Працівник будівельного майданчику",
            "secondary": "Система моніторингу",
            "description": "Працівник реєструється в системі SafeHeight Monitor на початку робочої зміни для активації моніторингу його безпеки",
            "trigger": "Працівник приходить на будівельний майданчик та починає робочу зміну",
            "preconditions": [
                "Працівник має виданий IoT пристрій (браслет/каску з датчиками)",
                "Система SafeHeight Monitor активна та функціонує",
                "Працівник має дійсний обліковий запис в системі"
            ],
            "normal_flow": [
                "1. Працівник вмикає IoT пристрій",
                "2. Система автоматично виявляє пристрій",
                "3. Працівник сканує QR-код на вході на майданчик або вводить PIN-код",
                "4. Система ідентифікує працівника",
                "5. Система перевіряє медичний допуск та сертифікати",
                "6. Система активує моніторинг положення та стану працівника",
                "7. Працівник отримує підтвердження успішної реєстрації (звуковий сигнал + вібрація)",
                "8. Статус працівника змінюється на 'Активний' в панелі моніторингу"
            ],
            "alternative_flow": [
                "3a. QR-код не сканується:",
                "   3a.1. Система пропонує ввести PIN-код вручну",
                "   3a.2. Працівник вводить PIN-код",
                "   3a.3. Продовження з кроку 4",
                "5a. Медичний допуск прострочений:",
                "   5a.1. Система відхиляє реєстрацію",
                "   5a.2. Система сповіщає інженера з охорони праці",
                "   5a.3. Працівник не може розпочати роботу"
            ],
            "exceptions": [
                "IoT пристрій несправний - система повідомляє про необхідність заміни пристрою",
                "Відсутнє з'єднання з сервером - дані зберігаються локально та синхронізуються при відновленні",
                "Невірний PIN-код (3 спроби) - блокування облікового запису, сповіщення безпеки"
            ],
            "frequency": "Щоденно, на початку кожної зміни (2 рази на день для 2-змінного графіку)",
            "business_rules": [
                "BR-01: Працівник не може працювати без активної реєстрації в системі",
                "BR-02: Медичний допуск перевіряється автоматично при кожній реєстрації",
                "BR-03: Один пристрій може бути активним тільки для одного працівника одночасно"
            ],
            "special_requirements": [
                "Час реєстрації не повинен перевищувати 15 секунд",
                "Інтерфейс має бути простим для користувачів з різним рівнем технічної грамотності",
                "Підтримка офлайн режиму з синхронізацією"
            ],
            "assumptions": [
                "Працівники пройшли базове навчання роботи з системою",
                "IoT пристрої заряджені та справні",
                "Є стабільне покриття мережі на майданчику"
            ]
        },

        "UC-02": {
            "name": "Отримання попередження про небезпеку",
            "actor": "Працівник будівельного майданчику",
            "secondary": "AI система виявлення ризиків, Інженер з охорони праці",
            "description": "Працівник отримує автоматичне попередження від системи при виявленні ризику падіння з висоти",
            "trigger": "AI система виявляє високий ризик падіння на основі даних з IoT пристрою",
            "preconditions": [
                "Працівник зареєстрований в системі (UC-01)",
                "IoT пристрій активний та передає дані",
                "AI модель виявлення ризиків функціонує"
            ],
            "normal_flow": [
                "1. IoT датчики фіксують положення працівника, нахил, висоту",
                "2. Дані передаються в Azure IoT Hub в реальному часі",
                "3. AI модель аналізує дані та виявляє ризик падіння (ймовірність >70%)",
                "4. Система генерує попередження рівня 'Увага' або 'Критично'",
                "5. Працівник отримує аудіо та вібро сигнал на IoT пристрої",
                "6. На дисплеї браслета/каски відображається повідомлення",
                "7. Працівник підтверджує отримання попередження (натискання кнопки)",
                "8. Система фіксує час попередження та реакцію працівника",
                "9. Інженер з охорони праці отримує сповіщення в панелі моніторингу"
            ],
            "alternative_flow": [
                "4a. Рівень ризику критичний (>90%):",
                "   4a.1. Додатково сповіщається бригадир",
                "   4a.2. Сповіщення дублюється через SMS",
                "   4a.3. Активується аварійний протокол",
                "7a. Працівник не підтверджує попередження протягом 10 секунд:",
                "   7a.1. Система підвищує рівень тривоги",
                "   7a.2. Сповіщаються інженер з охорони праці та бригадир",
                "   7a.3. Ініціюється перевірка стану працівника"
            ],
            "exceptions": [
                "IoT пристрій вийшов з ладу під час роботи - негайне сповіщення інженера безпеки",
                "Хибне спрацювання (працівник в безпеці) - можливість скасувати тривогу з поясненням",
                "Відсутність реакції працівника - автоматичний виклик аварійної служби"
            ],
            "frequency": "За потреби, в середньому 2-5 попереджень на майданчик за зміну",
            "business_rules": [
                "BR-04: Час від виявлення ризику до сповіщення працівника не повинен перевищувати 2 секунди",
                "BR-05: Всі попередження логуються для аналізу та звітності",
                "BR-06: Критичні попередження не можуть бути проігноровані без підтвердження"
            ],
            "special_requirements": [
                "Точність AI моделі виявлення ризиків мінімум 95%",
                "Рівень хибних спрацювань не більше 5%",
                "Попередження має бути чітко помітним навіть в шумному середовищі"
            ],
            "assumptions": [
                "Працівник носить IoT пристрій правильно",
                "IoT датчики відкалібровані та точні",
                "Працівник здатний реагувати на попередження"
            ]
        },

        "UC-03": {
            "name": "Перегляд поточного статусу всіх працівників",
            "actor": "Інженер з охорони праці",
            "secondary": "Система моніторингу",
            "description": "Інженер з охорони праці переглядає в реальному часі статус всіх працівників на будівельному майданчику",
            "trigger": "Інженер відкриває панель моніторингу або за розкладом перевірки",
            "preconditions": [
                "Інженер автентифікований в системі",
                "Інженер має права доступу 'Safety Engineer'",
                "На майданчику є активні працівники"
            ],
            "normal_flow": [
                "1. Інженер входить в веб-додаток SafeHeight Monitor",
                "2. Система відображає dashboard з панеллю моніторингу",
                "3. На екрані показується список всіх активних працівників",
                "4. Для кожного працівника відображається: ім'я, статус, локація, час останнього оновлення, рівень ризику",
                "5. Карта майданчику показує розташування працівників",
                "6. Інженер може фільтрувати за статусом (Безпечно/Попередження/Критично)",
                "7. Інженер може вибрати конкретного працівника для деталей",
                "8. Система оновлює дані кожні 5 секунд автоматично"
            ],
            "alternative_flow": [
                "4a. Виявлено працівників з критичним статусом:",
                "   4a.1. Вони виділяються червоним кольором на верху списку",
                "   4a.2. Звучить звукове сповіщення",
                "   4a.3. Інженер переглядає деталі та вживає заходів",
                "6a. Фільтрація за локацією:",
                "   6a.1. Інженер вибирає зону на карті",
                "   6a.2. Система показує тільки працівників в цій зоні"
            ],
            "exceptions": [
                "Втрата зв'язку з IoT пристроєм - працівник позначається як 'Зв'язок втрачено'",
                "Помилка завантаження даних - система показує кешовані дані з позначкою часу",
                "Немає активних працівників - відображається відповідне повідомлення"
            ],
            "frequency": "Постійно протягом робочого дня, перевірки кожні 30-60 хвилин",
            "business_rules": [
                "BR-07: Інженер з охорони праці має доступ до всіх даних працівників",
                "BR-08: Дані оновлюються в реальному часі (затримка не більше 5 секунд)",
                "BR-09: Історія статусів зберігається мінімум 90 днів"
            ],
            "special_requirements": [
                "Інтерфейс має бути responsive для перегляду на планшеті",
                "Підтримка кількох одночасних сесій моніторингу",
                "Можливість експорту поточного стану в PDF"
            ],
            "assumptions": [
                "Інженер має відповідну підготовку для інтерпретації даних",
                "Система має достатню пропускну здатність для реалтайм оновлень"
            ]
        },

        "UC-04": {
            "name": "Налаштування правил виявлення ризиків",
            "actor": "Інженер з охорони праці",
            "secondary": "AI система, Системний адміністратор",
            "description": "Інженер налаштовує параметри та пороги для автоматичного виявлення ризиків падіння",
            "trigger": "Необхідність коригування чутливості системи або зміна умов роботи",
            "preconditions": [
                "Інженер має права 'Safety Engineer' з дозволом на конфігурацію",
                "Система моніторингу активна",
                "Є історичні дані для аналізу"
            ],
            "normal_flow": [
                "1. Інженер відкриває розділ 'Налаштування ризиків'",
                "2. Система показує поточні правила та їх параметри",
                "3. Інженер вибирає тип ризику (висота, нахил, швидкість руху, зона небезпеки)",
                "4. Інженер налаштовує пороги спрацювання (наприклад: висота >3м + нахил >30°)",
                "5. Інженер встановлює рівень серйозності (Попередження/Критично)",
                "6. Інженер тестує правило на історичних даних",
                "7. Система показує прогноз кількості спрацювань",
                "8. Інженер підтверджує та зберігає правило",
                "9. Система активує нове правило для всіх IoT пристроїв",
                "10. Змін логується в журналі аудиту"
            ],
            "alternative_flow": [
                "6a. Тестування показує занадто багато хибних спрацювань:",
                "   6a.1. Система попереджає про високий рівень false positives",
                "   6a.2. Інженер коригує параметри",
                "   6a.3. Повторює тестування",
                "8a. Правило конфліктує з існуючими:",
                "   8a.1. Система показує конфлікт",
                "   8a.2. Інженер вирішує конфлікт (пріоритет/об'єднання)",
                "   8a.3. Продовження з кроку 9"
            ],
            "exceptions": [
                "Недостатньо історичних даних для тестування - система попереджає про обмежену точність прогнозу",
                "Правило занадто м'яке (спрацює завжди) - система блокує збереження",
                "Помилка синхронізації з IoT пристроями - повторна спроба через 1 хвилину"
            ],
            "frequency": "1-2 рази на місяць або при зміні умов майданчику",
            "business_rules": [
                "BR-10: Зміни в правилах мають бути схвалені старшим інженером безпеки",
                "BR-11: Всі зміни логуються з позначкою користувача та часу",
                "BR-12: Критичні правила не можуть бути деактивовані без обґрунтування"
            ],
            "special_requirements": [
                "Інтерфейс налаштування має бути інтуїтивним",
                "Можливість відкату до попередньої конфігурації",
                "Візуалізація впливу правил на історичних даних"
            ],
            "assumptions": [
                "Інженер розуміє специфіку ризиків на майданчику",
                "AI модель може адаптуватися до нових правил"
            ]
        },

        "UC-05": {
            "name": "Реагування на критичне попередження",
            "actor": "Інженер з охорони праці",
            "secondary": "Працівник, Бригадир, Аварійна служба",
            "description": "Інженер реагує на критичне попередження про загрозу життю працівника та координує дії",
            "trigger": "Система генерує критичне попередження (ризик >90% або відсутність реакції працівника)",
            "preconditions": [
                "Критичне попередження активне в системі",
                "Інженер має активну сесію або отримав push-сповіщення",
                "Працівник в зоні ризику"
            ],
            "normal_flow": [
                "1. Інженер отримує критичне сповіщення (звук + екран)",
                "2. Система показує деталі: ім'я працівника, локація, тип ризику, час",
                "3. Інженер переглядає відеопотік з найближчої камери (якщо доступна)",
                "4. Інженер оцінює ситуацію",
                "5. Інженер зв'язується з працівником через систему голосового зв'язку",
                "6. Інженер дає інструкції працівнику",
                "7. Інженер сповіщає бригадира для фізичної перевірки",
                "8. Бригадир підтверджує прибуття до працівника",
                "9. Інженер отримує підтвердження усунення загрози",
                "10. Інженер закриває інцидент з коментарем",
                "11. Система генерує звіт про інцидент"
            ],
            "alternative_flow": [
                "5a. Працівник не відповідає:",
                "   5a.1. Інженер негайно викликає аварійну службу",
                "   5a.2. Інженер направляє бригадира та найближчих працівників",
                "   5a.3. Інженер ескалює до менеджера проекту",
                "6a. Ситуація критична (працівник падає):",
                "   6a.1. Автоматичний виклик швидкої",
                "   6a.2. Система фіксує всі дані для розслідування",
                "   6a.3. Сповіщаються всі відповідальні особи"
            ],
            "exceptions": [
                "Хибна тривога (працівник в безпеці) - інженер закриває з позначкою 'False alarm', дані йдуть на покращення AI",
                "Множинні критичні попередження одночасно - система пріоритизує за рівнем ризику",
                "Втрата зв'язку з працівником під час інциденту - негайна фізична перевірка"
            ],
            "frequency": "Рідко, цільовий показник: 0-2 на місяць на майданчик",
            "business_rules": [
                "BR-13: Час реакції на критичне попередження не повинен перевищувати 30 секунд",
                "BR-14: Всі критичні інциденти розслідуються протягом 24 годин",
                "BR-15: Інцидент не може бути закритий без підтвердження безпеки працівника"
            ],
            "special_requirements": [
                "Мобільний додаток для інженера для реагування поза офісом",
                "Інтеграція з системами екстреного зв'язку",
                "Запис всіх дій інженера для аудиту"
            ],
            "assumptions": [
                "Інженер завжди доступний під час робочих змін",
                "Бригадир знаходиться на майданчику",
                "Аварійні служби можуть прибути протягом 10-15 хвилин"
            ]
        },

        "UC-06": {
            "name": "Перегляд місцезнаходження команди",
            "actor": "Бригадир",
            "secondary": "Система моніторингу",
            "description": "Бригадир переглядає в реальному часі розташування членів своєї бригади на майданчику",
            "trigger": "Бригадир потребує координації роботи команди або перевірки розташування",
            "preconditions": [
                "Бригадир автентифікований в системі",
                "Бригадир має призначену бригаду",
                "Члени бригади зареєстровані та активні"
            ],
            "normal_flow": [
                "1. Бригадир відкриває мобільний додаток SafeHeight",
                "2. Система показує інтерактивну карту майданчику",
                "3. На карті відображаються всі члени бригади з іменами",
                "4. Кожен працівник позначений іконкою з індикатором статусу (зелений/жовтий/червоний)",
                "5. Бригадир може натиснути на працівника для деталей",
                "6. Система показує: ім'я, поточне завдання, час в поточній зоні, статус безпеки",
                "7. Бригадир може відфільтрувати за завданням або зоною",
                "8. Система оновлює локації кожні 10 секунд"
            ],
            "alternative_flow": [
                "5a. Працівник поза межами дозволеної зони:",
                "   5a.1. Іконка працівника мигає жовтим",
                "   5a.2. Бригадир може надіслати повідомлення працівнику",
                "   5a.3. Система фіксує факт виходу за межі зони"
            ],
            "exceptions": [
                "Працівник в зоні без GPS покриття - показується остання відома локація з позначкою часу",
                "Дані локації застарілі (>2 хвилини) - працівник позначається як 'Локація невідома'"
            ],
            "frequency": "Регулярно протягом зміни, в середньому 10-15 разів за зміну",
            "business_rules": [
                "BR-16: Бригадир бачить тільки свою бригаду (не інші бригади)",
                "BR-17: Локація працівників зберігається для аудиту протягом 30 днів"
            ],
            "special_requirements": [
                "Додаток має працювати на планшетах Android/iOS",
                "Карта має працювати в офлайн режимі з кешованими даними",
                "Точність визначення локації ±2 метри"
            ],
            "assumptions": [
                "Бригадир має планшет або смартфон",
                "GPS сигнал доступний на більшості майданчику"
            ]
        },

        "UC-07": {
            "name": "Призначення робочих зон",
            "actor": "Бригадир",
            "secondary": "Працівник, Система моніторингу",
            "description": "Бригадир призначає конкретні робочі зони для членів бригади на поточну зміну",
            "trigger": "Початок зміни або зміна плану робіт",
            "preconditions": [
                "Бригадир автентифікований",
                "Робочі зони визначені на карті майданчику",
                "Працівники зареєстровані в системі"
            ],
            "normal_flow": [
                "1. Бригадир відкриває розділ 'Управління бригадою'",
                "2. Система показує список працівників бригади та карту зон",
                "3. Бригадир вибирає працівника зі списку",
                "4. Бригадир вибирає робочу зону на карті",
                "5. Бригадир вказує тип завдання та очікуваний час роботи",
                "6. Бригадир підтверджує призначення",
                "7. Система надсилає сповіщення працівнику з деталями",
                "8. Працівник підтверджує отримання завдання",
                "9. Зона призначення відображається на картах всіх користувачів",
                "10. Система активує моніторинг відповідності працівника зоні"
            ],
            "alternative_flow": [
                "3-6a. Масове призначення:",
                "   3a.1. Бригадир вибирає кількох працівників",
                "   3a.2. Призначає одну зону всім",
                "8a. Працівник не підтвердив протягом 5 хвилин:",
                "   8a.1. Система повторно сповіщає",
                "   8a.2. Бригадир отримує сповіщення про відсутність підтвердження"
            ],
            "exceptions": [
                "Зона вже призначена іншому працівнику - система попереджає про конфлікт",
                "Працівник не має кваліфікації для роботи в зоні - система блокує призначення",
                "Зона позначена як небезпечна - система вимагає додаткове підтвердження"
            ],
            "frequency": "2-3 рази на зміну (початок + переназначення)",
            "business_rules": [
                "BR-18: Працівник не може бути призначений на більш ніж одну зону одночасно",
                "BR-19: Призначення зберігається в системі для звітності",
                "BR-20: Система попереджає, якщо працівник покидає призначену зону"
            ],
            "special_requirements": [
                "Інтуїтивний drag-and-drop інтерфейс призначення",
                "Візуалізація завантаженості зон"
            ],
            "assumptions": [
                "Бригадир знає кваліфікацію своїх працівників",
                "Робочі зони попередньо сконфігуровані в системі"
            ]
        },

        "UC-08": {
            "name": "Налаштування IoT пристроїв",
            "actor": "Системний адміністратор",
            "secondary": "Azure IoT Hub, Працівник",
            "description": "Адміністратор реєструє, налаштовує та калібрує IoT пристрої (браслети, каски) в системі",
            "trigger": "Отримання нових пристроїв або необхідність перенал аштування існуючих",
            "preconditions": [
                "Адміністратор має права 'System Admin'",
                "IoT пристрій фізично доступний",
                "Azure IoT Hub функціонує"
            ],
            "normal_flow": [
                "1. Адміністратор підключає IoT пристрій до комп'ютера через USB",
                "2. Адміністратор відкриває утиліту конфігурації пристроїв",
                "3. Система автоматично виявляє підключений пристрій",
                "4. Адміністратор вводить серійний номер та тип пристрою",
                "5. Система генерує унікальний Device ID",
                "6. Адміністратор реєструє пристрій в Azure IoT Hub",
                "7. Система завантажує firmware та конфігурацію на пристрій",
                "8. Адміністратор проводить калібрування датчиків (акселерометр, GPS)",
                "9. Система тестує підключення до IoT Hub",
                "10. Адміністратор підтверджує успішне налаштування",
                "11. Пристрій додається до пулу доступних для призначення"
            ],
            "alternative_flow": [
                "7a. Firmware пристрою застаріла:",
                "   7a.1. Система пропонує оновлення",
                "   7a.2. Адміністратор підтверджує",
                "   7a.3. Відбувається OTA update",
                "9a. Тест підключення не вдався:",
                "   9a.1. Система діагностує проблему (WiFi, сертифікат, тощо)",
                "   9a.2. Адміністратор виправляє налаштування",
                "   9a.3. Повторний тест"
            ],
            "exceptions": [
                "Пристрій несправний - система рекомендує відправити на ремонт/заміну",
                "Серійний номер вже зареєстрований - система попереджає про дублікат",
                "Помилка з'єднання з Azure IoT Hub - збереження конфігурації локально, синхронізація пізніше"
            ],
            "frequency": "При надходженні нових пристроїв або щомісячному техобслуговуванні",
            "business_rules": [
                "BR-21: Кожен пристрій має унікальний Device ID в Azure IoT Hub",
                "BR-22: Пристрій має бути протестований перед призначенням працівнику",
                "BR-23: Калібрування проводиться кожні 3 місяці для точності"
            ],
            "special_requirements": [
                "Підтримка різних моделей IoT пристроїв",
                "Автоматичне виявлення та ідентифікація пристроїв",
                "Журналування всіх налаштувань для аудиту"
            ],
            "assumptions": [
                "Адміністратор має технічні навички роботи з IoT",
                "Є стабільне інтернет-з'єднання для доступу до Azure"
            ]
        },

        "UC-09": {
            "name": "Керування користувачами системи",
            "actor": "Системний адміністратор",
            "secondary": "Працівники, Інженери, Бригадири",
            "description": "Адміністратор створює, редагує та деактивує облікові записи користувачів системи",
            "trigger": "Прийом нових співробітників, зміна ролей або звільнення",
            "preconditions": [
                "Адміністратор автентифікований з правами 'System Admin'",
                "Є затверджена заявка на зміну користувачів"
            ],
            "normal_flow": [
                "1. Адміністратор відкриває розділ 'Управління користувачами'",
                "2. Адміністратор натискає 'Додати користувача'",
                "3. Адміністратор заповнює форму: ПІБ, email, посада, роль, бригада (якщо Працівник)",
                "4. Адміністратор встановлює рівень доступу (Worker/Foreman/Safety Engineer/Admin)",
                "5. Адміністратор генерує тимчасовий PIN-код для першого входу",
                "6. Система створює обліковий запис",
                "7. Система надсилає привітальний email з інструкціями",
                "8. Адміністратор призначає IoT пристрій користувачу (для працівників)",
                "9. Обліковий запис активується",
                "10. Користувач отримує доступ до системи"
            ],
            "alternative_flow": [
                "2a. Редагування існуючого користувача:",
                "   2a.1. Адміністратор шукає користувача за іменем/email",
                "   2a.2. Відкриває профіль",
                "   2a.3. Редагує необхідні поля",
                "   2a.4. Зберігає зміни",
                "2b. Деактивація користувача:",
                "   2b.1. Адміністратор вибирає користувача",
                "   2b.2. Натискає 'Деактивувати'",
                "   2b.3. Вказує причину деактивації",
                "   2b.4. Система блокує доступ та відв'язує IoT пристрій"
            ],
            "exceptions": [
                "Email вже існує в системі - помилка дублікату",
                "Невалідний формат даних - валідаційна помилка з поясненням",
                "Помилка відправки email - користувач створений, але потребує ручного повідомлення"
            ],
            "frequency": "За потреби, в середньому 2-5 разів на тиждень",
            "business_rules": [
                "BR-24: Деактивовані користувачі зберігаються в системі для історії",
                "BR-25: Зміна ролі вимагає підтвердження від менеджера",
                "BR-26: Адміністратор не може деактивувати власний обліковий запис"
            ],
            "special_requirements": [
                "Інтеграція з корпоративною AD/LDAP (опційно)",
                "Масовий імпорт користувачів з CSV",
                "Аудит всіх змін користувачів"
            ],
            "assumptions": [
                "Є валідні дані про нового користувача",
                "Користувач має корпоративну email адресу"
            ]
        },

        "UC-10": {
            "name": "Перегляд звітів з безпеки",
            "actor": "Менеджер проекту",
            "secondary": "Система звітності",
            "description": "Менеджер переглядає аналітичні звіти про інциденти, попередження та загальний стан безпеки",
            "trigger": "Регулярні звіти (щотижневі/щомісячні) або за запитом",
            "preconditions": [
                "Менеджер автентифікований",
                "Менеджер має права 'Project Manager'",
                "В системі є дані за звітний період"
            ],
            "normal_flow": [
                "1. Менеджер відкриває розділ 'Звіти та аналітика'",
                "2. Менеджер вибирає тип звіту (Інциденти/Попередження/KPI безпеки)",
                "3. Менеджер встановлює період (тиждень/місяць/квартал)",
                "4. Менеджер вибирає фільтри (майданчик, бригада, тип ризику)",
                "5. Система генерує звіт з візуалізацією",
                "6. Звіт показує: кількість інцидентів, типи ризиків, тренди, порівняння з попереднім періодом",
                "7. Менеджер переглядає деталі конкретних інцидентів",
                "8. Менеджер може експортувати звіт (PDF/Excel)",
                "9. Менеджер може запланувати автоматичну відправку звіту на email"
            ],
            "alternative_flow": [
                "2a. Вибір дашборду реалтайм:",
                "   2a.1. Система показує поточні KPI",
                "   2a.2. Онлайн графіки з метриками безпеки",
                "   2a.3. Оновлення кожні 5 хвилин"
            ],
            "exceptions": [
                "Недостатньо даних за період - система попереджає та пропонує розширити період",
                "Помилка генерації звіту - система логує помилку та повідомляє адміністратора"
            ],
            "frequency": "Щотижня для регулярних звітів, за потреби для спеціальних аналізів",
            "business_rules": [
                "BR-27: Звіти зберігаються в системі протягом 3 років",
                "BR-28: Конфіденційні дані працівників анонімізовані в загальних звітах",
                "BR-29: Критичні інциденти автоматично включаються в щотижневий звіт"
            ],
            "special_requirements": [
                "Візуалізація трендів графіками та діаграмами",
                "Можливість порівняння між майданчиками",
                "Експорт в різних форматах (PDF, Excel, CSV)"
            ],
            "assumptions": [
                "Менеджер розуміє метрики безпеки",
                "Дані в системі коректні та повні"
            ]
        },

        "UC-11": {
            "name": "Аналіз трендів аварійності",
            "actor": "Менеджер проекту",
            "secondary": "AI система аналітики, Інженер з охорони праці",
            "description": "Менеджер аналізує тренди аварійності для виявлення паттернів та вжиття превентивних заходів",
            "trigger": "Періодичний аналіз або зростання кількості інцидентів",
            "preconditions": [
                "Менеджер має доступ до модуля аналітики",
                "В системі накопичені дані мінімум за 1 місяць",
                "AI модуль аналітики активний"
            ],
            "normal_flow": [
                "1. Менеджер відкриває 'Аналіз трендів'",
                "2. Система показує AI-генерований огляд трендів",
                "3. Менеджер бачить: зони з найбільшою аварійністю, найчастіші типи ризиків, часові паттерни",
                "4. Система виділяє аномалії (різкі зростання інцидентів)",
                "5. Менеджер вибирає конкретний тренд для детального аналізу",
                "6. Система показує кореляції (наприклад: інциденти зростають в певні години)",
                "7. AI генерує рекомендації для зменшення ризиків",
                "8. Менеджер переглядає рекомендації",
                "9. Менеджер може створити action plan на основі рекомендацій",
                "10. Менеджер ділиться аналізом з інженером з охорони праці"
            ],
            "alternative_flow": [
                "5a. Вибір порівняльного аналізу:",
                "   5a.1. Менеджер вибирає 2+ майданчики/періоди",
                "   5a.2. Система показує порівняльну статистику",
                "   5a.3. Виявляються найкращі практики"
            ],
            "exceptions": [
                "Недостатньо даних для AI аналізу - система пропонує описову статистику",
                "AI виявила некоректні дані - система позначає та рекомендує перевірку"
            ],
            "frequency": "Щомісяця або квартально",
            "business_rules": [
                "BR-30: Аналіз трендів проводиться мінімум раз на квартал",
                "BR-31: Рекомендації AI мають бути перевірені фахівцем",
                "BR-32: Action plans відстежуються до виконання"
            ],
            "special_requirements": [
                "Використання ML для предиктивної аналітики",
                "Інтерактивні візуалізації з drill-down",
                "Natural language insights від AI"
            ],
            "assumptions": [
                "AI модель натренована на достатній кількості даних",
                "Менеджер має компетенції для інтерпретації статистики"
            ]
        }
    }

    return use_cases


def create_use_case_markdown(uc_id, uc_data):
    """Створює Markdown файл для одного use case"""

    content = f"""# {uc_id}: {uc_data['name']}

## Інформація про Use Case

| Поле | Значення |
|------|----------|
| **Ідентифікатор та назва** | {uc_id}: {uc_data['name']} |
| **Автор** | Постановський Ігор (ІСП-ХХ) |
| **Дата створення** | {datetime.now().strftime('%Y-%m-%d')} |
| **Основна дійова особа** | {uc_data['actor']} |
| **Додаткова дійова особа** | {uc_data['secondary']} |

## Опис

{uc_data['description']}

## Тригер

{uc_data['trigger']}

## Попередні умови

"""

    for precond in uc_data['preconditions']:
        content += f"- {precond}\n"

    content += "\n## Нормальний напрямок подій\n\n"
    for step in uc_data['normal_flow']:
        content += f"{step}\n"

    content += "\n## Альтернативний напрямок подій\n\n"
    for alt in uc_data['alternative_flow']:
        content += f"{alt}\n"

    content += "\n## Винятки\n\n"
    for exc in uc_data['exceptions']:
        content += f"- {exc}\n"

    content += f"\n## Частота використання\n\n{uc_data['frequency']}\n"

    content += "\n## Бізнес правила\n\n"
    for rule in uc_data['business_rules']:
        content += f"- {rule}\n"

    content += "\n## Спеціальні вимоги\n\n"
    for req in uc_data['special_requirements']:
        content += f"- {req}\n"

    content += "\n## Припущення\n\n"
    for assume in uc_data['assumptions']:
        content += f"- {assume}\n"

    content += "\n---\n\n*Лабораторна робота №2, Use Case*\n"

    return content


def create_use_case_diagram():
    """Створює PlantUML діаграму use cases"""

    diagram = """@startuml UseCaseDiagram

title Діаграма варіантів використання\\nSafeHeight Monitor - Система моніторингу будівельних майданчиків

left to right direction

' Стилізація
skinparam actorStyle awesome
skinparam packageStyle rectangle
skinparam usecase {
    BackgroundColor LightYellow
    BorderColor DarkOrange
    ArrowColor DarkOrange
}

' Актори (зліва)
actor "Працівник\\nбудівельного\\nмайданчику" as Worker
actor "Інженер з\\nохорони праці" as SafetyEng
actor "Бригадир" as Foreman
actor "Системний\\nадміністратор" as Admin
actor "Менеджер\\nпроекту" as PM

' Зовнішні системи (справа)
actor "Azure IoT Hub" as IoTHub
actor "AI система" as AI
actor "Аварійна\\nслужба" as Emergency

' Система
rectangle "SafeHeight Monitor System" {

    ' Use Cases для Працівника
    usecase "UC-01:\\nРеєстрація в системі\\nна початку зміни" as UC01
    usecase "UC-02:\\nОтримання\\nпопередження\\nпро небезпеку" as UC02

    ' Use Cases для Інженера з охорони праці
    usecase "UC-03:\\nПерегляд поточного\\nстатусу всіх\\nпрацівників" as UC03
    usecase "UC-04:\\nНалаштування правил\\nвиявлення ризиків" as UC04
    usecase "UC-05:\\nРеагування на\\nкритичне\\nпопередження" as UC05

    ' Use Cases для Бригадира
    usecase "UC-06:\\nПерегляд\\nмісцезнаходження\\nкоманди" as UC06
    usecase "UC-07:\\nПризначення\\nробочих зон" as UC07

    ' Use Cases для Системного адміністратора
    usecase "UC-08:\\nНалаштування\\nIoT пристроїв" as UC08
    usecase "UC-09:\\nКерування\\nкористувачами\\nсистеми" as UC09

    ' Use Cases для Менеджера проекту
    usecase "UC-10:\\nПерегляд звітів\\nз безпеки" as UC10
    usecase "UC-11:\\nАналіз трендів\\nаварійності" as UC11

    ' Загальні use cases (include)
    usecase "Автентифікація" as Auth
    usecase "Відправка\\nсповіщення" as Notify
    usecase "Логування\\nподії" as Log
    usecase "Аналіз AI" as AIAnalysis
}

' Зв'язки Працівника
Worker --> UC01
Worker --> UC02

' Зв'язки Інженера з охорони праці
SafetyEng --> UC03
SafetyEng --> UC04
SafetyEng --> UC05

' Зв'язки Бригадира
Foreman --> UC06
Foreman --> UC07

' Зв'язки Адміністратора
Admin --> UC08
Admin --> UC09

' Зв'язки Менеджера
PM --> UC10
PM --> UC11

' Include відношення
UC01 .> Auth : <<include>>
UC03 .> Auth : <<include>>
UC04 .> Auth : <<include>>
UC05 .> Auth : <<include>>
UC06 .> Auth : <<include>>
UC07 .> Auth : <<include>>
UC08 .> Auth : <<include>>
UC09 .> Auth : <<include>>
UC10 .> Auth : <<include>>
UC11 .> Auth : <<include>>

UC02 .> Notify : <<include>>
UC05 .> Notify : <<include>>
UC07 .> Notify : <<include>>

UC01 .> Log : <<include>>
UC02 .> Log : <<include>>
UC05 .> Log : <<include>>
UC09 .> Log : <<include>>

UC02 .> AIAnalysis : <<include>>
UC04 .> AIAnalysis : <<include>>
UC11 .> AIAnalysis : <<include>>

' Extend відношення
UC05 ..> UC03 : <<extend>>\\n(критична\\nситуація)

' Взаємодія з зовнішніми системами
UC01 --> IoTHub : використовує
UC02 --> IoTHub : використовує
UC08 --> IoTHub : конфігурує

AIAnalysis --> AI : використовує
UC04 --> AI : налаштовує

UC05 --> Emergency : викликає\\n(критична\\nситуація)

@enduml"""

    readme = """# Діаграма варіантів використання

## Опис

Діаграма показує всі варіанти використання системи SafeHeight Monitor та їх зв'язки з користувачами.

## Актори (Користувачі системи)

### Основні актори:
1. **Працівник будівельного майданчику** - основний користувач, якого система захищає
2. **Інженер з охорони праці** - моніторить безпеку та реагує на інциденти
3. **Бригадир** - керує командою та координує роботу
4. **Системний адміністратор** - налаштовує та підтримує систему
5. **Менеджер проекту** - аналізує звіти та приймає стратегічні рішення

### Зовнішні системи:
- **Azure IoT Hub** - управління IoT пристроями
- **AI система** - аналіз ризиків та генерація рекомендацій
- **Аварійна служба** - реагування на критичні ситуації

## Типи відношень на діаграмі

### Include (<<include>>)
Показує обов'язкову залежність - базовий use case завжди включає функціонал іншого:
- Всі use cases включають **Автентифікацію**
- UC-02, UC-05, UC-07 включають **Відправку сповіщення**
- UC-01, UC-02, UC-05, UC-09 включають **Логування події**
- UC-02, UC-04, UC-11 включають **Аналіз AI**

### Extend (<<extend>>)
Показує розширення функціоналу за певних умов:
- **UC-05** (Реагування на критичне попередження) розширює **UC-03** (Перегляд статусу) при критичній ситуації

## Групування Use Cases за користувачами

### Працівник (2 use cases):
- UC-01: Реєстрація в системі на початку зміни
- UC-02: Отримання попередження про небезпеку

### Інженер з охорони праці (3 use cases):
- UC-03: Перегляд поточного статусу всіх працівників
- UC-04: Налаштування правил виявлення ризиків
- UC-05: Реагування на критичне попередження

### Бригадир (2 use cases):
- UC-06: Перегляд місцезнаходження команди
- UC-07: Призначення робочих зон

### Системний адміністратор (2 use cases):
- UC-08: Налаштування IoT пристроїв
- UC-09: Керування користувачами системи

### Менеджер проекту (2 use cases):
- UC-10: Перегляд звітів з безпеки
- UC-11: Аналіз трендів аварійності

## Ключові характеристики системи

1. **Безпека** - автентифікація для всіх операцій
2. **Прозорість** - логування всіх критичних подій
3. **Інтелектуальність** - AI аналіз для виявлення ризиків
4. **Комунікація** - сповіщення в реальному часі
5. **Інтеграція** - взаємодія з Azure IoT Hub та зовнішніми службами

---

*Лабораторна робота №2, Діаграма Use Cases*
"""

    return diagram, readme


def main():
    """Основна функція генерації Lab 2"""

    print("[INFO] Генерація лабораторної роботи №2...")
    print(f"[INFO] Базовий шлях: {BASE_PATH}")

    # Створюємо структуру каталогів
    usecases_path = os.path.join(LAB2_PATH, "1.1-UseCases")
    diagram_path = os.path.join(LAB2_PATH, "1.2-UseCaseDiagram")
    images_path = os.path.join(diagram_path, "images")

    os.makedirs(usecases_path, exist_ok=True)
    os.makedirs(diagram_path, exist_ok=True)
    os.makedirs(images_path, exist_ok=True)

    print(f"[OK] Створено структуру каталогів")

    # Створюємо головний README для Lab 2
    lab2_readme = """# Лабораторна робота №2

**Тема:** Виявлення вимог до нового програмного продукту

**Проект:** SafeHeight Monitor - Веб-додаток моніторингу будівельних майданчиків з AI для запобігання падінням з висоти

**Варіант:** 7 - Виявляти і інформувати про ризик для працівників на майданчику через падіння з висоти

---

## Зміст

1. [Варіанти використання (Use Cases)](./1.1-UseCases/)
2. [Діаграма варіантів використання](./1.2-UseCaseDiagram/)

---

## Опис завдання

Визначення вимог користувача через створення варіантів використання (Use Cases) та діаграми використання для системи SafeHeight Monitor.

### Виконано:

- ✅ Визначено 5 типів користувачів системи
- ✅ Створено 11 детальних варіантів використання
- ✅ Складено текстовий опис кожного use case за стандартним шаблоном
- ✅ Створено діаграму use cases (PlantUML)
- ✅ Визначено відношення include та extend між use cases

### Користувачі системи:

1. **Працівник будівельного майданчику** - носить IoT пристрій, отримує попередження
2. **Інженер з охорони праці** - моніторить безпеку, реагує на інциденти
3. **Бригадир** - керує командою, призначає зони
4. **Системний адміністратор** - налаштовує систему та пристрої
5. **Менеджер проекту** - аналізує звіти та тренди

---

*Лабораторна робота №2, Системна інженерія програмного забезпечення*
"""

    with open(os.path.join(LAB2_PATH, "README.md"), 'w', encoding='utf-8') as f:
        f.write(lab2_readme)
    print("[OK] Створено головний README.md для Lab 2")

    # Генеруємо use cases
    use_cases = create_use_cases()

    # Створюємо README для папки use cases
    usecases_readme = """# Варіанти використання (Use Cases)

Детальні описи всіх варіантів використання системи SafeHeight Monitor.

## Список Use Cases

### Працівник будівельного майданчику
- [UC-01: Реєстрація в системі на початку зміни](./UC-01.md)
- [UC-02: Отримання попередження про небезпеку](./UC-02.md)

### Інженер з охорони праці
- [UC-03: Перегляд поточного статусу всіх працівників](./UC-03.md)
- [UC-04: Налаштування правил виявлення ризиків](./UC-04.md)
- [UC-05: Реагування на критичне попередження](./UC-05.md)

### Бригадир
- [UC-06: Перегляд місцезнаходження команди](./UC-06.md)
- [UC-07: Призначення робочих зон](./UC-07.md)

### Системний адміністратор
- [UC-08: Налаштування IoT пристроїв](./UC-08.md)
- [UC-09: Керування користувачами системи](./UC-09.md)

### Менеджер проекту
- [UC-10: Перегляд звітів з безпеки](./UC-10.md)
- [UC-11: Аналіз трендів аварійності](./UC-11.md)

---

## Шаблон Use Case

Кожен use case описано за стандартним шаблоном:
- Ідентифікатор та назва
- Автор та дата створення
- Основна та додаткова дійові особи
- Опис
- Тригер
- Попередні умови
- Нормальний напрямок подій
- Альтернативний напрямок подій
- Винятки
- Частота використання
- Бізнес правила
- Спеціальні вимоги
- Припущення

---

*Лабораторна робота №2, Use Cases*
"""

    with open(os.path.join(usecases_path, "README.md"), 'w', encoding='utf-8') as f:
        f.write(usecases_readme)
    print("[OK] Створено README.md для use cases")

    # Створюємо файли для кожного use case
    for uc_id, uc_data in use_cases.items():
        uc_content = create_use_case_markdown(uc_id, uc_data)
        uc_filename = f"{uc_id}.md"

        with open(os.path.join(usecases_path, uc_filename), 'w', encoding='utf-8') as f:
            f.write(uc_content)

        print(f"[OK] Створено {uc_filename}")

    # Створюємо діаграму use cases
    diagram_puml, diagram_readme = create_use_case_diagram()

    with open(os.path.join(diagram_path, "diagram.puml"), 'w', encoding='utf-8') as f:
        f.write(diagram_puml)
    print("[OK] Створено diagram.puml")

    with open(os.path.join(diagram_path, "README.md"), 'w', encoding='utf-8') as f:
        f.write(diagram_readme)
    print("[OK] Створено README.md для діаграми")

    print("\n" + "="*60)
    print("ВСІ ФАЙЛИ УСПІШНО СТВОРЕНО!")
    print("="*60)
    print("\nСтворені файли:")
    print(f"   1. README.md (головний для Lab 2)")
    print(f"   2. 1.1-UseCases/README.md")
    print(f"   3. 1.1-UseCases/UC-01.md ... UC-11.md (11 файлів)")
    print(f"   4. 1.2-UseCaseDiagram/diagram.puml")
    print(f"   5. 1.2-UseCaseDiagram/README.md")
    print(f"\nНаступні кроки:")
    print(f"   1. Згенерувати PNG діаграми:")
    print(f"      python generate_diagram_fixed.py (для Lab 2 діаграми)")
    print(f"   2. Git commit та push на GitHub")

if __name__ == "__main__":
    main()
